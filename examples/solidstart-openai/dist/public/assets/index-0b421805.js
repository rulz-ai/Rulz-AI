const Ge=(e,t)=>e===t,ee={equals:Ge};let Se=ke;const V=1,te=2,Xe={owned:null,cleanups:null,context:null,owner:null},oe={};var k=null;let le=null,E=null,I=null,T=null,ae=0;function C(e,t){t=t?Object.assign({},ee,t):ee;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=a=>(typeof a=="function"&&(a=a(n.value)),_e(n,a));return[Ie.bind(n),r]}function ve(e,t,n){const r=fe(e,t,!0,V);Q(r)}function ze(e,t,n){Se=nt;const r=fe(e,t,!1,V);(!n||!n.render)&&(r.user=!0),T?T.push(r):Q(r)}function Qe(e,t,n){n=n?Object.assign({},ee,n):ee;const r=fe(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Q(r),Ie.bind(r)}function Ke(e,t,n){let r,a,s;arguments.length===2&&typeof t=="object"||arguments.length===1?(r=!0,a=e,s=t||{}):(r=e,a=t,s=n||{});let o=null,i=oe,l=!1,c="initialValue"in s,g=typeof r=="function"&&Qe(r);const f=new Set,[u,p]=(s.storage||C)(s.initialValue),[v,_]=C(void 0),[w,N]=C(void 0,{equals:!1}),[m,D]=C(c?"ready":"unresolved");function x(d,h,b,P){return o===d&&(o=null,P!==void 0&&(c=!0),(d===i||h===i)&&s.onHydrated&&queueMicrotask(()=>s.onHydrated(P,{value:h})),i=oe,O(h,b)),h}function O(d,h){W(()=>{h===void 0&&p(()=>d),D(h!==void 0?"errored":c?"ready":"unresolved"),_(h);for(const b of f.keys())b.decrement();f.clear()},!1)}function L(){const d=Ze,h=u(),b=v();if(b!==void 0&&!o)throw b;return E&&!E.user&&d&&ve(()=>{w(),o&&(d.resolved||f.has(d)||(d.increment(),f.add(d)))}),h}function A(d=!0){if(d!==!1&&l)return;l=!1;const h=g?g():r;if(h==null||h===!1){x(o,ue(u));return}const b=i!==oe?i:ue(()=>a(h,{value:u(),refetching:d}));return typeof b!="object"||!(b&&"then"in b)?(x(o,b,void 0,h),b):(o=b,l=!0,queueMicrotask(()=>l=!1),W(()=>{D(c?"refreshing":"pending"),N()},!1),b.then(P=>x(b,P,void 0,h),P=>x(b,void 0,Ae(P),h)))}return Object.defineProperties(L,{state:{get:()=>m()},error:{get:()=>v()},loading:{get(){const d=m();return d==="pending"||d==="refreshing"}},latest:{get(){if(!c)return L();const d=v();if(d&&!o)throw d;return u()}}}),g?ve(()=>A(!1)):A(!1),[L,{refetch:A,mutate:p}]}function ue(e){if(E===null)return e();const t=E;E=null;try{return e()}finally{E=t}}function Ye(e){return k===null||(k.cleanups===null?k.cleanups=[e]:k.cleanups.push(e)),e}let Ze;function Ie(){if(this.sources&&this.state)if(this.state===V)Q(this);else{const e=I;I=null,W(()=>re(this),!1),I=e}if(E){const e=this.observers?this.observers.length:0;E.sources?(E.sources.push(this),E.sourceSlots.push(e)):(E.sources=[this],E.sourceSlots=[e]),this.observers?(this.observers.push(E),this.observerSlots.push(E.sources.length-1)):(this.observers=[E],this.observerSlots=[E.sources.length-1])}return this.value}function _e(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&W(()=>{for(let a=0;a<e.observers.length;a+=1){const s=e.observers[a],o=le&&le.running;o&&le.disposed.has(s),(o?!s.tState:!s.state)&&(s.pure?I.push(s):T.push(s),s.observers&&De(s)),o||(s.state=V)}if(I.length>1e6)throw I=[],new Error},!1)),t}function Q(e){if(!e.fn)return;de(e);const t=k,n=E,r=ae;E=k=e,et(e,e.value,r),E=n,k=t}function et(e,t,n){let r;try{r=e.fn(t)}catch(a){return e.pure&&(e.state=V,e.owned&&e.owned.forEach(de),e.owned=null),e.updatedAt=n+1,Ce(a)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?_e(e,r):e.value=r,e.updatedAt=n)}function fe(e,t,n,r=V,a){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:k,context:null,pure:n};return k===null||k!==Xe&&(k.owned?k.owned.push(s):k.owned=[s]),s}function ne(e){if(e.state===0)return;if(e.state===te)return re(e);if(e.suspense&&ue(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ae);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===V)Q(e);else if(e.state===te){const r=I;I=null,W(()=>re(e,t[0]),!1),I=r}}function W(e,t){if(I)return e();let n=!1;t||(I=[]),T?n=!0:T=[],ae++;try{const r=e();return tt(n),r}catch(r){n||(T=null),I=null,Ce(r)}}function tt(e){if(I&&(ke(I),I=null),e)return;const t=T;T=null,t.length&&W(()=>Se(t),!1)}function ke(e){for(let t=0;t<e.length;t++)ne(e[t])}function nt(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:ne(r)}for(t=0;t<n;t++)ne(e[t])}function re(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const a=r.state;a===V?r!==t&&(!r.updatedAt||r.updatedAt<ae)&&ne(r):a===te&&re(r,t)}}}function De(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=te,n.pure?I.push(n):T.push(n),n.observers&&De(n))}}function de(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),a=n.observers;if(a&&a.length){const s=a.pop(),o=n.observerSlots.pop();r<a.length&&(s.sourceSlots[o]=r,a[r]=s,n.observerSlots[r]=o)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)de(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function Ae(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ce(e,t=k){throw Ae(e)}function rt(e,t,n){let[r,a]=C(e.get(t(),{shouldRevalidate:n.shouldRevalidate,initialData:n.initialData,hydrate:n.hydrate}));return ze(()=>{let s=t();Ye(e.subscribe(s,()=>{a(()=>e.get(s,{shouldRevalidate:!1}))}))}),r}function Oe(e,t,n){let r=rt(e,t,n),[a]=Ke(r,async s=>{if(s.status==="failure")throw s.data;return s.data},"initialData"in n?{initialValue:n.initialData,ssrLoadFrom:"initial"}:{});return a}var ye=Object.prototype.hasOwnProperty;function se(e,t){var n,r;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((r=e.length)===t.length)for(;r--&&se(e[r],t[r]););return r===-1}if(!n||typeof e=="object"){r=0;for(n in e)if(ye.call(e,n)&&++r&&!ye.call(t,n)||!(n in t)||!se(e[n],t[n]))return!1;return Object.keys(t).length===r}}return e!==e&&t!==t}function Le(){return{cache:new Map,subscribers:new Map}}function st(e,t,n){let r=e.cache.get(t);if(r)return r;let a={value:n};return e.cache.set(t,a),a}function Me(e,t,n){let r=e.subscribers.get(t);return r||(r=new Set,e.subscribers.set(t,r)),r.add(n),()=>{r&&r.delete(n)}}function Re(e,t,n,r=!0){let a=st(e,t,n);if(a.value=n,r){let s=e.subscribers.get(t);s||(s=new Set,e.subscribers.set(t,s));for(let o of s.keys())o(n)}}function at(e,t){let n=e.subscribers.get(t);return n?n.size:0}var ie=Le();function it(e,t){return Me(ie,e,t)}function $(e,t){Re(ie,e,t)}function Z(e){let t=ie.cache.get(e);if(t)return t.value}function je(e){return at(ie,e)}var Ne=Le();function ot(e,t){return Me(Ne,e,t)}function pe(e,t,n=!0){Re(Ne,e,t,n)}function lt(e,t=!0){pe(e,t)}function ct(e,t,n=!0,r=se){pe(e,n);let a=Z(e);if(a&&a.result.status==="success"&&t.status==="success"&&r(a.result.data,t.data)){a.timestamp=Date.now();return}$(e,{result:t,timestamp:Date.now(),isValidating:!1})}function ut(e,t){return it(e,n=>{t(n)})}function ft(...e){return JSON.stringify(e)}var dt={revalidateOnFocus:!1,revalidateOnNetwork:!1,revalidateOnVisibility:!1,refreshWhenHidden:!1,refreshWhenBlurred:!1,refreshWhenOffline:!1,freshAge:2e3,staleAge:3e4,key:ft,compare:se,maxRetryInterval:5e3},pt=dt,ht=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",wt=ht;function mt(){let e=()=>{},t=()=>{};return{promise:new Promise((n,r)=>{e=n,t=r}),resolve:e,reject:t}}function gt(e,t){let n=!0,r,a=mt(),s=(o=10,i=0)=>{let l=c=>{!n||typeof t.count=="number"&&t.count<=i?a.reject(c):r=window.setTimeout(()=>{s(Math.max(10,Math.min(t.interval,o*2)),i+1)},o)};try{e().then(a.resolve,l)}catch(c){l(c)}};return s(),{resolvable:a,cancel:()=>{r&&clearTimeout(r),n=!1}}}var be=0;function vt(){let e=be;return be+=1,e}var Ee=new Map,{assign:Pe}=Object;function Te(e,t,n){let r={shouldRevalidate:!0,initialData:e.initialData,hydrate:!1},a=Pe({},r,n),s=e.key(...t),o=Date.now(),i=Z(s);if(!i&&a.initialData&&(i={result:{data:a.initialData,status:"success"},timestamp:o,isValidating:!1},a.hydrate&&$(s,i)),i){if(!a.shouldRevalidate||i.timestamp+e.freshAge>o)return i.result;if(i.result.status==="pending"){let f=Ee.get(s);f&&f.cancel()}}let l=gt(()=>e.get(...t),{count:e.maxRetryCount,interval:e.maxRetryInterval});Ee.set(s,l);let c=l.resolvable.promise,g={data:c,status:"pending"};return c.then(f=>{let u=Z(s);(()=>u==null?!0:u.timestamp>o?!1:u.result.status==="success"?!e.compare(u.result.data,f):!0)()&&$(s,{result:{data:f,status:"success"},timestamp:u&&u.timestamp?u.timestamp:Date.now(),isValidating:!1})},f=>{let u=Z(s);(()=>u==null?!0:!(u.timestamp>o))()&&$(s,{result:{data:f,status:"failure"},timestamp:u&&u.timestamp?u.timestamp:Date.now(),isValidating:!1})}),i&&i.timestamp+e.freshAge+e.staleAge>o?(i.timestamp=o,i.isValidating=!0,i.result):($(s,{result:g,timestamp:o,isValidating:!0}),g)}function yt(e,t,n,r){if(je(t)>0)return;let a=[],s=i=>{a.push(i())},o=()=>{pe(t,!0)};s(()=>ot(t,i=>{Te(n,r,{shouldRevalidate:i})})),wt&&(n.refreshInterval!=null&&(n.refreshWhenBlurred&&s(()=>{let i,l=()=>{window.clearInterval(i),i=window.setInterval(o,n.refreshInterval)},c=()=>{window.clearInterval(i),i=void 0};return window.addEventListener("blur",l,!1),window.addEventListener("focus",c,!1),()=>{window.removeEventListener("blur",l,!1),window.removeEventListener("focus",c,!1),window.clearInterval(i)}}),n.refreshWhenOffline&&s(()=>{let i,l=()=>{window.clearInterval(i),i=window.setInterval(o,n.refreshInterval)},c=()=>{window.clearInterval(i),i=void 0};return window.addEventListener("offline",l,!1),window.addEventListener("online",c,!1),()=>{window.removeEventListener("offline",l,!1),window.removeEventListener("online",c,!1),window.clearInterval(i)}}),n.refreshWhenHidden&&s(()=>{let i,l=()=>{window.clearInterval(i),document.visibilityState==="visible"?i=void 0:i=window.setInterval(o,n.refreshInterval)};return document.addEventListener("visibilitychange",l,!1),()=>{document.removeEventListener("visibilitychange",l,!1),window.clearInterval(i)}}),n.refreshWhenHidden||n.refreshWhenBlurred||n.refreshWhenOffline||s(()=>{let i=window.setInterval(o,n.refreshInterval);return()=>{window.clearInterval(i)}})),n.revalidateOnFocus&&s(()=>(window.addEventListener("focus",o,!1),()=>{window.removeEventListener("focus",o,!1)})),n.revalidateOnNetwork&&s(()=>(window.addEventListener("online",o,!1),()=>{window.removeEventListener("online",o,!1)})),n.revalidateOnVisibility&&s(()=>{let i=()=>{document.visibilityState==="visible"&&o()};return window.addEventListener("visibilitychange",i,!1),()=>{window.removeEventListener("visibilitychange",i,!1)}})),e.set(t,a)}function bt(e,t){if(je(t)===0){let n=e.get(t);if(n){for(let r=0,a=n.length;r<a;r+=1)n[r]();e.delete(t)}}}function Ve(e){let t=Pe({},pt,e),n=new Map;return{id:`SWRStore-${vt()}`,trigger:(r,a=!0)=>{let s=t.key(...r);lt(s,a)},mutate:(r,a,s=!0,o=t.compare)=>{let i=t.key(...r);ct(i,a,s,o)},get:(r,a)=>Te(t,r,a),subscribe:(r,a)=>{let s=t.key(...r);yt(n,s,t,r);let o=ut(s,a);return()=>{o(),bt(n,s)}}}}let Et=(e,t=21)=>(n=t)=>{let r="",a=n;for(;a--;)r+=e[Math.random()*e.length|0];return r};var H={code:"0",name:"text",parse:e=>{if(typeof e!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:e}}},J={code:"1",name:"function_call",parse:e=>{if(e==null||typeof e!="object"||!("function_call"in e)||typeof e.function_call!="object"||e.function_call==null||!("name"in e.function_call)||!("arguments"in e.function_call)||typeof e.function_call.name!="string"||typeof e.function_call.arguments!="string")throw new Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},F={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw new Error('"data" parts expect an array value.');return{type:"data",value:e}}},G={code:"3",name:"error",parse:e=>{if(typeof e!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:e}}},X={code:"4",name:"assistant_message",parse:e=>{if(e==null||typeof e!="object"||!("id"in e)||!("role"in e)||!("content"in e)||typeof e.id!="string"||typeof e.role!="string"||e.role!=="assistant"||!Array.isArray(e.content)||!e.content.every(t=>t!=null&&typeof t=="object"&&"type"in t&&t.type==="text"&&"text"in t&&t.text!=null&&typeof t.text=="object"&&"value"in t.text&&typeof t.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},z={code:"5",name:"assistant_control_data",parse:e=>{if(e==null||typeof e!="object"||!("threadId"in e)||!("messageId"in e)||typeof e.threadId!="string"||typeof e.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},xt=[H,J,F,G,X,z],St={[H.code]:H,[J.code]:J,[F.code]:F,[G.code]:G,[X.code]:X,[z.code]:z};H.name+"",H.code,J.name+"",J.code,F.name+"",F.code,G.name+"",G.code,X.name+"",X.code,z.name+"",z.code;var It=xt.map(e=>e.code),We=e=>{const t=e.indexOf(":");if(t===-1)throw new Error("Failed to parse stream string. No separator found.");const n=e.slice(0,t);if(!It.includes(n))throw new Error(`Failed to parse stream string. Invalid code ${n}.`);const r=n,a=e.slice(t+1),s=JSON.parse(a);return St[r].parse(s)},_t=`
`.charCodeAt(0);function kt(e,t){const n=new Uint8Array(t);let r=0;for(const a of e)n.set(a,r),r+=a.length;return e.length=0,n}async function*qe(e,{isAborted:t}={}){const n=new TextDecoder,r=[];let a=0;for(;;){const{value:s}=await e.read();if(s&&(r.push(s),a+=s.length,s[s.length-1]!==_t))continue;if(r.length===0)break;const o=kt(r,a);a=0;const i=n.decode(o,{stream:!0}).split(`
`).filter(l=>l!=="").map(We);for(const l of i)yield l;if(t?.()){e.cancel();break}}}var Ue=Et("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function Be(e){const t=new TextDecoder;return e?function(n){return t.decode(n,{stream:!0}).split(`
`).filter(a=>a!=="").map(We).filter(Boolean)}:function(n){return n?t.decode(n,{stream:!0}):""}}var $e="X-Experimental-Stream-Data";async function Dt({reader:e,abortControllerRef:t,update:n,onFinish:r,generateId:a=Ue,getCurrentDate:s=()=>new Date}){const o=s(),i={data:[]};for await(const{type:l,value:c}of qe(e,{isAborted:()=>t?.current===null})){l==="text"&&(i.text?i.text={...i.text,content:(i.text.content||"")+c}:i.text={id:a(),role:"assistant",content:c,createdAt:o});let g=null;l==="function_call"&&(i.function_call={id:a(),role:"assistant",content:"",function_call:c.function_call,name:c.function_call.name,createdAt:o},g=i.function_call),l==="data"&&i.data.push(...c);const f=i.text,u=[g,f].filter(Boolean);n(u,[...i.data])}return r?.(i),{messages:[i.text,i.function_call].filter(Boolean),data:i.data}}async function At({api:e,messages:t,body:n,credentials:r,headers:a,abortController:s,appendMessage:o,restoreMessagesOnFailure:i,onResponse:l,onUpdate:c,onFinish:g,generateId:f}){var u;const p=await fetch(e,{method:"POST",body:JSON.stringify({messages:t,...n}),headers:{"Content-Type":"application/json",...a},signal:(u=s?.())==null?void 0:u.signal,credentials:r}).catch(w=>{throw i(),w});if(l)try{await l(p)}catch(w){throw w}if(!p.ok)throw i(),new Error(await p.text()||"Failed to fetch the chat response.");if(!p.body)throw new Error("The response body is empty.");const v=p.body.getReader();if(p.headers.get($e)==="true")return await Dt({reader:v,abortControllerRef:s!=null?{current:s()}:void 0,update:c,onFinish(w){g&&w.text!=null&&g(w.text)},generateId:f});{const w=new Date,N=Be(!1);let m="",x={id:f(),createdAt:w,content:"",role:"assistant"};for(;;){const{done:O,value:L}=await v.read();if(O)break;if(m+=N(L),m.startsWith('{"function_call":')?x.function_call=m:x.content=m,o({...x}),s?.()===null){v.cancel();break}}if(m.startsWith('{"function_call":')){const O=JSON.parse(m).function_call;x.function_call=O,o({...x})}return g&&g(x),x}}async function Ct({getStreamedResponse:e,experimental_onFunctionCall:t,updateChatRequest:n,getCurrentMessages:r}){for(;;){const a=await e();if("messages"in a){let s=!1;for(const o of a.messages)if(!(o.function_call===void 0||typeof o.function_call=="string")&&(s=!0,t)){const i=o.function_call,l=await t(r(),i);if(l===void 0){s=!1;break}n(l)}if(!s)break}else{const s=a;if(s.function_call===void 0||typeof s.function_call=="string")break;if(t){const o=s.function_call,i=await t(r(),o);if(i===void 0)break;n(i)}}}}var Ot=0,He={},ce=Ve({get:async e=>{var t;return(t=He[e])!=null?t:[]}});function Rt({api:e="/api/chat",id:t,initialMessages:n=[],initialInput:r="",sendExtraMessageFields:a,experimental_onFunctionCall:s,onResponse:o,onFinish:i,onError:l,credentials:c,headers:g,body:f,generateId:u=Ue}={}){const p=t||`chat-${Ot++}`,v=`${e}|${p}`,_=Oe(ce,()=>[v],{initialData:n}),w=y=>(He[v]=y,ce.mutate([v],{status:"success",data:y})),[N,m]=C(void 0),[D,x]=C(void 0),[O,L]=C(!1);let A=null;async function d(y,S){try{m(void 0),L(!0),A=new AbortController;const M=()=>ce.get([v],{shouldRevalidate:!1}),we=M();w(y);let U={messages:y,options:S};await Ct({getStreamedResponse:async()=>{var K;const Fe=(K=D())!=null?K:[];return await At({api:e,messages:a?U.messages:U.messages.map(({role:B,content:Y,name:me,function_call:ge})=>({role:B,content:Y,...me!==void 0&&{name:me},...ge!==void 0&&{function_call:ge}})),body:{...f,...S?.body},headers:{...g,...S?.headers},abortController:()=>A,credentials:c,onResponse:o,onUpdate(B,Y){w([...U.messages,...B]),x([...Fe,...Y??[]])},onFinish:i,appendMessage(B){w([...U.messages,B])},restoreMessagesOnFailure(){we.status==="success"&&w(we.data)},generateId:u})},experimental_onFunctionCall:s,updateChatRequest(K){U=K},getCurrentMessages:()=>M().data}),A=null}catch(M){if(M.name==="AbortError")return A=null,null;l&&M instanceof Error&&l(M),m(M)}finally{L(!1)}}const h=async(y,S)=>{var M;return y.id||(y.id=u()),d(((M=_())!=null?M:[]).concat(y),S)},b=async y=>{const S=_();return!S||S.length===0?null:S[S.length-1].role==="assistant"?d(S.slice(0,-1),y):d(S,y)},P=()=>{A&&(A.abort(),A=null)},R=y=>{w(y)},[j,q]=C(r);return{messages:_,append:h,error:N,reload:b,stop:P,setMessages:R,input:j,setInput:q,handleSubmit:y=>{y.preventDefault();const S=j();S&&(h({content:S,role:"user",createdAt:new Date}),q(""))},isLoading:O,data:D}}async function Lt({api:e,prompt:t,credentials:n,headers:r,body:a,setCompletion:s,setLoading:o,setError:i,setAbortController:l,onResponse:c,onFinish:g,onError:f,onData:u}){try{o(!0),i(void 0);const p=new AbortController;l(p),s("");const v=await fetch(e,{method:"POST",body:JSON.stringify({prompt:t,...a}),credentials:n,headers:{"Content-Type":"application/json",...r},signal:p.signal}).catch(m=>{throw m});if(c)try{await c(v)}catch(m){throw m}if(!v.ok)throw new Error(await v.text()||"Failed to fetch the chat response.");if(!v.body)throw new Error("The response body is empty.");let _="";const w=v.body.getReader();if(v.headers.get($e)==="true")for await(const{type:m,value:D}of qe(w,{isAborted:()=>p===null}))switch(m){case"text":{_+=D,s(_);break}case"data":{u?.(D);break}}else{const m=Be();for(;;){const{done:D,value:x}=await w.read();if(D)break;if(_+=m(x),s(_),p===null){w.cancel();break}}}return g&&g(t,_),l(null),_}catch(p){if(p.name==="AbortError")return l(null),null;p instanceof Error&&f&&f(p),i(p)}finally{o(!1)}}var Mt=0,Je={},xe=Ve({get:async e=>{var t;return(t=Je[e])!=null?t:[]}});function jt({api:e="/api/completion",id:t,initialCompletion:n="",initialInput:r="",credentials:a,headers:s,body:o,onResponse:i,onFinish:l,onError:c}={}){const g=t||`completion-${Mt++}`,f=`${e}|${g}`,u=Oe(xe,()=>[f],{initialData:n}),p=R=>(Je[f]=R,xe.mutate([f],{data:R,status:"success"})),v=u,[_,w]=C(void 0),[N,m]=C(void 0),[D,x]=C(!1);let O=null;const L=async(R,j)=>{var q;const he=(q=N())!=null?q:[];return Lt({api:e,prompt:R,credentials:a,headers:{...s,...j?.headers},body:{...o,...j?.body},setCompletion:p,setLoading:x,setError:w,setAbortController:y=>{O=y},onResponse:i,onFinish:l,onError:c,onData:y=>{m([...he,...y??[]])}})},A=()=>{O&&(O.abort(),O=null)},d=R=>{p(R)},[h,b]=C(r);return{completion:v,complete:L,error:_,stop:A,setCompletion:d,input:h,setInput:b,handleSubmit:R=>{R.preventDefault();const j=h();if(j)return L(j)},isLoading:D,data:N}}export{jt as a,Et as c,Rt as u};
